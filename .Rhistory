fdp$big5C<- fdp$tipi7_grundig - fdp$tipi2_magelig
fdp$big5E<- fdp$tipi5_udadv - fdp$tipi0_reserv
fdp$big5A<- fdp$tipi1_stole - fdp$tipi6_fejlfok
fdp$big5N<- fdp$tipi3_ustress - fdp$tipi8_nervoes
summary(lm(cheatrate2~tipi5O+tipi5C+tipi5E+tipi5A+tipi5N,data=fdp))
summary(lm(cheatrate2~big5O+big5C+big5E+big5A+big5N,data=fdp))
summary(lm(cheatrate2~big5O+big5C+big5E+big5A+big5N+age+gender,data=fdp))
summary(lm(cheatrate2~big5O+big5C+big5E+big5A+big5N+age+gender+field,data=fdp))
summary(lm(cheatrate2~big5O+big5C+big5E+big5A+big5N+age+gender+glpol+nypol,data=fdp))
summary(lm(cheatrate2~big5O+big5C+big5E+big5A+big5N+age+gender+glpol+nypol+I(nypol^2)+I(glpol^2)+ects,data=fdp))
summary(lm(cheatrate2~big5O+big5C+big5E+big5A+big5N+age+gender+glpol+nypol+ects,data=fdp))
big5dat<-rbind(data.frame(val=fdp$big5O,var="Openness"),data.frame(val=fdp$big5C,var="Conscientiousness"),data.frame(val=fdp$big5E,var="Extraversion"),data.frame(val=fdp$big5A,var="Agreeableness"),data.frame(val=fdp$big5N,var="Neuroticism"))
ggplot(big5dat,aes(x=val)) + geom_histogram() + facet_wrap(var)
ggplot(big5dat,aes(x=val)) + geom_histogram() + facet_wrap(var) + theme_bw(~var)
head(big5dat)
str(big5dat)
ggplot(big5dat,aes(x=val)) + geom_histogram()
ggplot(big5dat,aes(x=val)) + geom_histogram() + facet_wrap(~var) + theme_bw()
table(fdp$big5O)
table(fdp$big5C)
table(fdp$tipi7_grundig)
table(fdp$tipi2_magelig)
fdp$big5O<- (fdp$tipi9_fantasi - fdp$tipi4_ukunst + 4) / 8
fdp$big5C<- (fdp$tipi7_grundig - fdp$tipi2_magelig + 4) / 8
fdp$big5E<- (fdp$tipi5_udadv - fdp$tipi0_reserv + 4) / 8
fdp$big5A<- (fdp$tipi1_stole - fdp$tipi6_fejlfok + 4) / 8
fdp$big5N<- (fdp$tipi3_ustress - fdp$tipi8_nervoes + 4) / 8
table(fdp$big5C)
table(fdp$big5O)
table(fdp$big5E)
table(fdp$big5A)
table(fdp$big5N)
fdp$big5C[!(fdp$big5C %in% 0:1)] <- NA
table(fdp$big5C)
fdp$big5O<- (fdp$tipi9_fantasi - fdp$tipi4_ukunst + 4) / 8
fdp$big5C<- (fdp$tipi7_grundig - fdp$tipi2_magelig + 4) / 8
fdp$big5E<- (fdp$tipi5_udadv - fdp$tipi0_reserv + 4) / 8
fdp$big5A<- (fdp$tipi1_stole - fdp$tipi6_fejlfok + 4) / 8
fdp$big5N<- (fdp$tipi3_ustress - fdp$tipi8_nervoes + 4) / 8
fdp$big5C[!(fdp$big5C > 1)] <- NA
fdp$big5E[!(fdp$big5E > 1)] <- NA
fdp$big5A[!(fdp$big5A < 0)] <- NA
big5m0<-lm(cheatrate2~big5O+big5C+big5E+big5A+big5N,data=fdp)
big5m1<-lm(cheatrate2~big5O+big5C+big5E+big5A+big5N+age+gender,data=fdp)
big5m2<-lm(cheatrate2~big5O+big5C+big5E+big5A+big5N+age+gender+glpol+nypol+ects,data=fdp)
big5dat<-rbind(data.frame(val=fdp$big5O,var="Openness"),data.frame(val=fdp$big5C,var="Conscientiousness"),data.frame(val=fdp$big5E,var="Extraversion"),data.frame(val=fdp$big5A,var="Agreeableness"),data.frame(val=fdp$big5N,var="Neuroticism"))
ggplot(big5dat,aes(x=val)) + geom_histogram() + facet_wrap(~var) + theme_bw()
fdp$big5O<- (fdp$tipi9_fantasi - fdp$tipi4_ukunst + 4) / 8
fdp$big5C<- (fdp$tipi7_grundig - fdp$tipi2_magelig + 4) / 8
fdp$big5E<- (fdp$tipi5_udadv - fdp$tipi0_reserv + 4) / 8
fdp$big5A<- (fdp$tipi1_stole - fdp$tipi6_fejlfok + 4) / 8
fdp$big5N<- (fdp$tipi3_ustress - fdp$tipi8_nervoes + 4) / 8
fdp$big5C[fdp$big5C > 1] <- NA
fdp$big5E[fdp$big5E > 1] <- NA
fdp$big5A[fdp$big5A < 0] <- NA
big5m0<-lm(cheatrate2~big5O+big5C+big5E+big5A+big5N,data=fdp)
big5m1<-lm(cheatrate2~big5O+big5C+big5E+big5A+big5N+age+gender,data=fdp)
big5m2<-lm(cheatrate2~big5O+big5C+big5E+big5A+big5N+age+gender+glpol+nypol+ects,data=fdp)
big5dat<-rbind(data.frame(val=fdp$big5O,var="Openness"),data.frame(val=fdp$big5C,var="Conscientiousness"),data.frame(val=fdp$big5E,var="Extraversion"),data.frame(val=fdp$big5A,var="Agreeableness"),data.frame(val=fdp$big5N,var="Neuroticism"))
ggplot(big5dat,aes(x=val)) + geom_histogram() + facet_wrap(~var) + theme_bw()
stargazer(big5m0,big5m1,big5m2,style="apsr",type="latex",align=TRUE,omit.stat=c("f"))
summary(big5m1)$coefficients
summary(big5m1)$coefficients[2:6,1:2]
big5mests<-data.frame(rbind(summary(big5m1)$coefficients[2:6,1:2],summary(big5m2)$coefficients[2:6,1:2])
)
big5mests<-data.frame(rbind(summary(big5m1)$coefficients[2:6,1:2],summary(big5m2)$coefficients[2:6,1:2]))
big5mests
stargazer(big5m0,big5m1,big5m2,style="apsr",type="latex",align=TRUE,omit.stat=c("f"))
big5mests$dim<-rep(c("Openness","Conscientiousness","Extraversion","Agreeableness","Neuroticism"),2)
big5mests
big5mests$model<-c(rep("Model 2",5),rep("Model 3",5))
names(big5mests)[1:2]
names(big5mests)[1:2]<-c("est","se")
ggplot(big5mests,aes(x=est)) + geom_point() + facet_grid(dim~model) + theme_bw()
ggplot(big5mests,aes(x=est,y=dim)) + geom_point() + facet_grid(.~model) + theme_bw()
ggplot(big5mests,aes(x=est,y=dim)) + geom_point() + facet_grid(.~model) + theme_bw() + geom_errorbarh(aes(xmin=est-1.95*se,xmax=est+1.95*se))
ggplot(big5mests,aes(x=est,y=dim)) + geom_point() + facet_grid(.~model) + theme_bw() + geom_errorbarh(aes(xmin=est-1.95*se,xmax=est+1.95*se),height=0)
ggplot(big5mests,aes(x=est,y=dim)) + geom_point() + facet_grid(.~model) + theme_bw() + geom_errorbarh(aes(xmin=est-1.95*se,xmax=est+1.95*se),height=0) + geom_vline(xintercept=0,linetype="dashed") + ylab("") + xlab("")
ggplot(big5mests,aes(x=est,y=dim)) + geom_point() + facet_grid(.~model) + theme_bw() + geom_errorbarh(aes(xmin=est-1.96*se,xmax=est+1.96*se),height=0) + geom_errorbarh(aes(xmin=est-1.65*se,xmax=est+1.65*se),height=0,size=1.2) + geom_vline(xintercept=0,linetype="dashed") + ylab("") + xlab("")
source('~/.active-rstudio-document', echo=TRUE)
summary(big5m2)
.75^2+.25^2
FT11.a<-read.csv(file="/Users/frederikhjorth/Dropbox/Data/ElectionStudy-2011/ElectionStudy-2011_F1.csv",sep=",")
FT11<-data.frame(elec=rep(elections$elec[11],nrow(FT11.a)),exat=NA,leftvot.p=NA,muninum=NA,muninam="NA",postalnum=NA,edu=NA,stringsAsFactors=F)
FT11$exat<-ifelse(FT11.a$v174<6,(FT11.a$v174-5)/-4,NA)
FT11$exat01<-ifelse(FT11$exat>mean(FT11$exat,na.rm=T),1,0)
FT11$exat.p<-recode(FT11.a$v169,"3=1;2=0;1=.5;8:9=NA")
#FT11$exat.p01<-ifelse(FT11$exat.p>mean(FT11$exat.p,na.rm=T),1,0)
FT11$vcrim<-ifelse(FT11.a$v177==1,1,0)
FT11$lrscale<-ifelse(FT11.a$v227<11,(FT11.a$v227)/10,NA)
FT11$envir<-ifelse(FT11.a$v176<6,(FT11.a$v176-5)/-4,NA)
FT11$muninum<-FT11.a$knr
FT11$postalnum<-as.character(FT11.a$Postnummer)
FT11$edu<-ifelse(FT11.a$v327<6,(FT11.a$v327-1)/4,.5)
FT11$hinc<-ifelse(FT11.a$v313<16,((FT11.a$v313-1)/14),NA)
FT11$emp.student<-ifelse(FT11.a$v333==5,1,0)
FT11$emp.pension<-ifelse(FT11.a$v333 %in% 8:9,1,0)
FT11$leftvot.p<-ifelse(FT11.a$v67 %in% c(1,2,4,6,9),1,0)
FT11$female<-ifelse(FT11.a$v5==5,1,0)
FT11$age<-as.numeric(format(elections$date[8], "%Y"))-FT11.a$v6
FT11$ethnic<-0
FT11$leftvot.c<-ifelse(FT11.a$v54 %in% c(1,2,4,9),1,0)
FT11$redvot.c<-ifelse(FT11.a$v54 %in% c(1,4,9),1,0)
FT11$ivday<-1
FT11$ivmonth<-11
FT11$ivyear<-2011
FT11$redist<-ifelse(FT11.a$v133<5,(FT11.a$v133-1)/3,NA)
FT11$renter<-ifelse(FT11.a$v315==1,1,0)
FV11$ivday<-1
FV11.a<-read.csv(file="/Users/frederikhjorth/Dropbox/Data/ElectionStudy-2011/ElectionStudy-2011_F1.csv",sep=",")
FV11<-data.frame(elec=rep("FV11",nrow(FV11.a)),exat=NA,leftvot.p=NA,muninum=NA,muninam="NA",postalnum=NA,edu=NA,stringsAsFactors=F)
FV11$exat<-ifelse(FV11.a$v174<6,(FV11.a$v174-5)/-4,NA)
FV11$exat01<-ifelse(FV11$exat>mean(FV11$exat,na.rm=T),1,0)
FV11$exat.p<-recode(FV11.a$v169,"3=1;2=0;1=.5;8:9=NA")
#FV11$exat.p01<-ifelse(FV11$exat.p>mean(FV11$exat.p,na.rm=T),1,0)
FV11$vcrim<-ifelse(FV11.a$v177==1,1,0)
FV11$lrscale<-ifelse(FV11.a$v227<11,(FV11.a$v227)/10,NA)
FV11$envir<-ifelse(FV11.a$v176<6,(FV11.a$v176-5)/-4,NA)
FV11$muninum<-FV11.a$knr
FV11$postalnum<-as.character(FV11.a$Postnummer)
FV11$edu<-ifelse(FV11.a$v327<6,(FV11.a$v327-1)/4,.5)
FV11$hinc<-ifelse(FV11.a$v313<16,((FV11.a$v313-1)/14),NA)
FV11$emp.student<-ifelse(FV11.a$v333==5,1,0)
FV11$emp.pension<-ifelse(FV11.a$v333 %in% 8:9,1,0)
FV11$leftvot.p<-ifelse(FV11.a$v67 %in% c(1,2,4,6,9),1,0)
FV11$female<-ifelse(FV11.a$v5==5,1,0)
FV11$age<-as.numeric(format(elections$date[8], "%Y"))-FV11.a$v6
FV11$ethnic<-0
FV11$leftvot.c<-ifelse(FV11.a$v54 %in% c(1,2,4,9),1,0)
FV11$redvot.c<-ifelse(FV11.a$v54 %in% c(1,4,9),1,0)
FV11$ivday<-1
FV11$ivmonth<-11
FV11$ivyear<-2011
FV11$redist<-ifelse(FV11.a$v133<5,(FV11.a$v133-1)/3,NA)
FV11$renter<-ifelse(FV11.a$v315==1,1,0)
rm(FV11.a)
FV11.a<-read.csv(file="/Users/frederikhjorth/Dropbox/Data/ElectionStudy-2011/ElectionStudy-2011_F1.csv",sep=",")
#get vars
FV11<-data.frame(elec=rep("FV11",nrow(FV11.a))
FV11$female<-ifelse(FV11.a$v5==5,1,0)
FV11$age<-2011-FV11.a$v6
FV11$edu<-NA
FV11$edu<-"Vil ikke svare"
FV11$edu<-NA
table(FV11.a$v328)
FV11$edu[FV11.a$v328==4]<-"Grundskole"
FV11$edu[FV11.a$v327 %in% 5:6]<-"Gymnasie"
table(FV11.a$v329)
FV11$edu<-NA
FV11$edu[FV11.a$v328==4]<-"Grundskole"
FV11$edu[FV11.a$v327 %in% 5:6]<-"Gymnasie"
FV11$edu[FV11.a$v329 %in% 5:6]<-"EUD"
FV11$edu[FV11.a$v329==7]<-"KVU"
FV11$edu[FV11.a$v329==8]<-"MVU"
FV11$edu[FV11.a$v329==10]<-"LVU"
table(FV11.a$v313)
FV11$hinc<-NA
table(FV11.a$v314)
FV11$hinc[FV11.a$v314==1]<-"<100k"
FV11.a<-read.csv(file="/Users/frederikhjorth/Dropbox/Data/ElectionStudy-2011/ElectionStudy-2011_F1.csv",sep=",")
#get vars
FV11<-data.frame(elec=rep("FV11",nrow(FV11.a))
FV11$female<-ifelse(FV11.a$v5==5,1,0)
FV11$age<-2011-FV11.a$v6
FV11$edu<-NA
FV11$edu[FV11.a$v328==4]<-"Grundskole"
FV11$edu[FV11.a$v327 %in% 5:6]<-"Gymnasie"
FV11$edu[FV11.a$v329 %in% 5:6]<-"EUD"
FV11$edu[FV11.a$v329==7]<-"KVU"
FV11$edu[FV11.a$v329==8]<-"MVU"
FV11$edu[FV11.a$v329==10]<-"LVU"
FV11$hinc<-NA
FV11$hinc[FV11.a$v314==1]<-"<100k"
FV11$hinc[FV11.a$v314 %in% 2:3]<-"100k-199k"
FV11$hinc[FV11.a$v314 %in% 4:5]<-"200k-299k"
FV11$hinc[FV11.a$v314 %in% 6:7]<-"300k-399k"
FV11$hinc[FV11.a$v314 %in% 8:9]<-"400k-499k"
FV11$hinc[FV11.a$v314==10]<-"500k-599k"
FV11$hinc[FV11.a$v314==11]<-"600k-699k"
FV11$hinc[FV11.a$v314==12]<-"700k-799k"
FV11$hinc[FV11.a$v314==13]<-"800k-899k"
FV11$hinc[FV11.a$v314==14]<-"900k-999k"
FV11$hinc[FV11.a$v314 %in% 15:20]<-">1M"
FV11$hinc[FV11.a$v314 %in% 88:99]<-"Vil ikke svare"
FV11$leftvot.p<-ifelse(FV11.a$v67 %in% c(1,2,4,6,9),1,0)
FV11$leftvot.c<-ifelse(FV11.a$v54 %in% c(1,2,4,6,9),1,0)
FV11$redvot.p<-ifelse(FV11.a$v67 %in% c(1,4,9),1,0)
FV11$redvot.c<-ifelse(FV11.a$v54 %in% c(1,4,9),1,0)
rm(FV11.a)
FV11.a<-read.csv(file="/Users/frederikhjorth/Dropbox/Data/ElectionStudy-2011/ElectionStudy-2011_F1.csv",sep=",")
#get vars
FV11<-data.frame(elec=rep("FV11",nrow(FV11.a)))
FV11$female<-ifelse(FV11.a$v5==5,1,0)
FV11$age<-2011-FV11.a$v6
FV11$edu<-NA
FV11$edu[FV11.a$v328==4]<-"Grundskole"
FV11$edu[FV11.a$v327 %in% 5:6]<-"Gymnasie"
FV11$edu[FV11.a$v329 %in% 5:6]<-"EUD"
FV11$edu[FV11.a$v329==7]<-"KVU"
FV11$edu[FV11.a$v329==8]<-"MVU"
FV11$edu[FV11.a$v329==10]<-"LVU"
FV11$hinc<-NA
FV11$hinc[FV11.a$v314==1]<-"<100k"
FV11$hinc[FV11.a$v314 %in% 2:3]<-"100k-199k"
FV11$hinc[FV11.a$v314 %in% 4:5]<-"200k-299k"
FV11$hinc[FV11.a$v314 %in% 6:7]<-"300k-399k"
FV11$hinc[FV11.a$v314 %in% 8:9]<-"400k-499k"
FV11$hinc[FV11.a$v314==10]<-"500k-599k"
FV11$hinc[FV11.a$v314==11]<-"600k-699k"
FV11$hinc[FV11.a$v314==12]<-"700k-799k"
FV11$hinc[FV11.a$v314==13]<-"800k-899k"
FV11$hinc[FV11.a$v314==14]<-"900k-999k"
FV11$hinc[FV11.a$v314 %in% 15:20]<-">1M"
FV11$hinc[FV11.a$v314 %in% 88:99]<-"Vil ikke svare"
FV11$leftvot.p<-ifelse(FV11.a$v67 %in% c(1,2,4,6,9),1,0)
FV11$leftvot.c<-ifelse(FV11.a$v54 %in% c(1,2,4,6,9),1,0)
FV11$redvot.p<-ifelse(FV11.a$v67 %in% c(1,4,9),1,0)
FV11$redvot.c<-ifelse(FV11.a$v54 %in% c(1,4,9),1,0)
rm(FV11.a)
View(FV11)
str(FV11)
FV11.a<-read.csv(file="/Users/frederikhjorth/Dropbox/Data/ElectionStudy-2011/ElectionStudy-2011_F1.csv",sep=",")
#get vars
FV11<-data.frame(elec=rep("FV11",nrow(FV11.a)))
FV11$female<-ifelse(FV11.a$v5==5,1,0)
FV11$age<-2011-FV11.a$v6
FV11$edu<-NA
FV11$edu[FV11.a$v328==4]<-"Grundskole"
FV11$edu[FV11.a$v327 %in% 5:6]<-"Gymnasie"
FV11$edu[FV11.a$v329 %in% 5:6]<-"EUD"
FV11$edu[FV11.a$v329==7]<-"KVU"
FV11$edu[FV11.a$v329==8]<-"MVU"
FV11$edu[FV11.a$v329==10]<-"LVU"
FV11$hinc<-NA
FV11$hinc[FV11.a$v314==1]<-"<100k"
FV11$hinc[FV11.a$v314 %in% 2:3]<-"100k-199k"
FV11$hinc[FV11.a$v314 %in% 4:5]<-"200k-299k"
FV11$hinc[FV11.a$v314 %in% 6:7]<-"300k-399k"
FV11$hinc[FV11.a$v314 %in% 8:9]<-"400k-499k"
FV11$hinc[FV11.a$v314==10]<-"500k-599k"
FV11$hinc[FV11.a$v314==11]<-"600k-699k"
FV11$hinc[FV11.a$v314==12]<-"700k-799k"
FV11$hinc[FV11.a$v314==13]<-"800k-899k"
FV11$hinc[FV11.a$v314==14]<-"900k-999k"
FV11$hinc[FV11.a$v314 %in% 15:20]<-">1M"
FV11$hinc[FV11.a$v314 %in% 88:99]<-"Vil ikke svare"
FV11$leftvot.p<-ifelse(FV11.a$v67 %in% c(1,2,4,6,9),1,0)
FV11$leftvot.c<-ifelse(FV11.a$v54 %in% c(1,2,4,6,9),1,0)
FV11$redvot.p<-ifelse(FV11.a$v67 %in% c(1,4,9),1,0)
FV11$redvot.c<-ifelse(FV11.a$v54 %in% c(1,4,9),1,0)
FV11$safeblue<-ifelse(FV11$leftvot.p==0 & FV11$leftvot.c==0,1,0)
FV11$safered<-ifelse(FV11$leftvot.p==1 & FV11$leftvot.c==1,1,0)
FV11$swingvoter<-(FV11$leftvot.p - FV11$leftvot.c)^2
rm(FV11.a)
str(FV11)
summary(glm(safeblue~female+age+I(age^2)+edu+hinc,data=FV11,family="binomial"))
summary(glm(safered~female+age+I(age^2)+edu+hinc,data=FV11,family="binomial"))
summary(glm(swingvoter~female+age+I(age^2)+edu+hinc,data=FV11,family="binomial"))
summary(mblue<-glm(safeblue~female+age+I(age^2)+edu+hinc,data=FV11,family="binomial"))
summary(mred<-glm(safered~female+age+I(age^2)+edu+hinc,data=FV11,family="binomial"))
summary(mswing<-glm(swingvoter~female+age+I(age^2)+edu+hinc,data=FV11,family="binomial"))
?predict.glm
predict(mswing,newdata=data.frame(age=18:80,female=0,edu=="Grundskole",hinc="400k-499k"),type="response")
predict(mswing,newdata=data.frame(age=18:80,female=0,edu="Grundskole",hinc="400k-499k"),type="response")
agepreds<-predict(mswing,newdata=data.frame(age=18:80,female=0,edu="Grundskole",hinc="400k-499k"),type="response")
agepreds<-data.frame(age=18:80,female=0,edu="Grundskole",hinc="400k-499k")
agepreds$swingpredict<-predict(mswing,newdata=agepreds,type="response")
agepreds
ggplot(agepreds,aes(x=age,y=swingpredict)) +
geom_line() +
theme_minimal()
require(ggplot2)
ggplot(agepreds,aes(x=age,y=swingpredict)) +
geom_line() +
theme_minimal()
agepreds<-as.data.frame(expand.grid(age=18:80,female=0,edu=levels(factor(FV11$edu)),hinc="400k-499k"))
agepreds$swingpredict<-predict(mswing,newdata=agepreds,type="response")
ggplot(agepreds,aes(x=age,y=swingpredict,group=edu)) +
geom_line() +
theme_minimal()
ggplot(agepreds,aes(x=age,y=swingpredict,group=edu,color=edu)) +
geom_line() +
theme_minimal()
setwd("~/GitHub/votingmodels")
setwd("~/GitHub/votingmodels")
poldata<-read.csv("poldata.csv")
View(poldata)
poldata$female<-ifelse(poldata$gender=="Kvinde",1,0)
FV11.a<-read.csv(file="/Users/frederikhjorth/Dropbox/Data/ElectionStudy-2011/ElectionStudy-2011_F1.csv",sep=",")
#get vars
FV11<-data.frame(elec=rep("FV11",nrow(FV11.a)))
FV11$female<-ifelse(FV11.a$v5==5,1,0)
FV11$age<-2011-FV11.a$v6
FV11$region<-FV11.a$region
FV11$edu<-NA
FV11$edu[FV11.a$v328==4]<-"Grundskole"
FV11$edu[FV11.a$v327 %in% 5:6]<-"Gymnasie"
FV11$edu[FV11.a$v329 %in% 5:6]<-"EUD"
FV11$edu[FV11.a$v329==7]<-"KVU"
FV11$edu[FV11.a$v329==8]<-"MVU"
FV11$edu[FV11.a$v329==10]<-"LVU"
FV11$hinc<-NA
FV11$hinc[FV11.a$v314==1]<-"<100k"
FV11$hinc[FV11.a$v314 %in% 2:3]<-"100k-199k"
FV11$hinc[FV11.a$v314 %in% 4:5]<-"200k-299k"
FV11$hinc[FV11.a$v314 %in% 6:7]<-"300k-399k"
FV11$hinc[FV11.a$v314 %in% 8:9]<-"400k-499k"
FV11$hinc[FV11.a$v314==10]<-"500k-599k"
FV11$hinc[FV11.a$v314==11]<-"600k-699k"
FV11$hinc[FV11.a$v314==12]<-"700k-799k"
FV11$hinc[FV11.a$v314==13]<-"800k-899k"
FV11$hinc[FV11.a$v314==14]<-"900k-999k"
FV11$hinc[FV11.a$v314 %in% 15:20]<-">1M"
FV11$hinc[FV11.a$v314 %in% 88:99]<-"Vil ikke svare"
FV11$leftvot.p<-ifelse(FV11.a$v67 %in% c(1,2,4,6,9),1,0)
FV11$leftvot.c<-ifelse(FV11.a$v54 %in% c(1,2,4,6,9),1,0)
FV11$redvot.p<-ifelse(FV11.a$v67 %in% c(1,4,9),1,0)
FV11$redvot.c<-ifelse(FV11.a$v54 %in% c(1,4,9),1,0)
FV11$safeblue<-ifelse(FV11$leftvot.p==0 & FV11$leftvot.c==0,1,0)
FV11$safered<-ifelse(FV11$leftvot.p==1 & FV11$leftvot.c==1,1,0)
FV11$swingvoter<-(FV11$leftvot.p - FV11$leftvot.c)^2
rm(FV11.a)
str(FV11)
#run voter models
summary(mblue<-glm(safeblue~female+age+I(age^2)+edu+hinc+region,data=FV11,family="binomial"))
summary(mred<-glm(safered~female+age+I(age^2)+edu+hinc+region,data=FV11,family="binomial"))
summary(mswing<-glm(swingvoter~female+age+I(age^2)+edu+hinc+region,data=FV11,family="binomial"))
FV11.a<-read.csv(file="/Users/frederikhjorth/Dropbox/Data/ElectionStudy-2011/ElectionStudy-2011_F1.csv",sep=",")
#get vars
FV11<-data.frame(elec=rep("FV11",nrow(FV11.a)))
FV11$female<-ifelse(FV11.a$v5==5,1,0)
FV11$age<-2011-FV11.a$v6
FV11$region<-as.factor(as.character(FV11.a$region))
FV11$edu<-NA
FV11$edu[FV11.a$v328==4]<-"Grundskole"
FV11$edu[FV11.a$v327 %in% 5:6]<-"Gymnasie"
FV11$edu[FV11.a$v329 %in% 5:6]<-"EUD"
FV11$edu[FV11.a$v329==7]<-"KVU"
FV11$edu[FV11.a$v329==8]<-"MVU"
FV11$edu[FV11.a$v329==10]<-"LVU"
FV11$hinc<-NA
FV11$hinc[FV11.a$v314==1]<-"<100k"
FV11$hinc[FV11.a$v314 %in% 2:3]<-"100k-199k"
FV11$hinc[FV11.a$v314 %in% 4:5]<-"200k-299k"
FV11$hinc[FV11.a$v314 %in% 6:7]<-"300k-399k"
FV11$hinc[FV11.a$v314 %in% 8:9]<-"400k-499k"
FV11$hinc[FV11.a$v314==10]<-"500k-599k"
FV11$hinc[FV11.a$v314==11]<-"600k-699k"
FV11$hinc[FV11.a$v314==12]<-"700k-799k"
FV11$hinc[FV11.a$v314==13]<-"800k-899k"
FV11$hinc[FV11.a$v314==14]<-"900k-999k"
FV11$hinc[FV11.a$v314 %in% 15:20]<-">1M"
FV11$hinc[FV11.a$v314 %in% 88:99]<-"Vil ikke svare"
FV11$leftvot.p<-ifelse(FV11.a$v67 %in% c(1,2,4,6,9),1,0)
FV11$leftvot.c<-ifelse(FV11.a$v54 %in% c(1,2,4,6,9),1,0)
FV11$redvot.p<-ifelse(FV11.a$v67 %in% c(1,4,9),1,0)
FV11$redvot.c<-ifelse(FV11.a$v54 %in% c(1,4,9),1,0)
FV11$safeblue<-ifelse(FV11$leftvot.p==0 & FV11$leftvot.c==0,1,0)
FV11$safered<-ifelse(FV11$leftvot.p==1 & FV11$leftvot.c==1,1,0)
FV11$swingvoter<-(FV11$leftvot.p - FV11$leftvot.c)^2
rm(FV11.a)
str(FV11)
#run voter models
summary(mblue<-glm(safeblue~female+age+I(age^2)+edu+hinc+region,data=FV11,family="binomial"))
summary(mred<-glm(safered~female+age+I(age^2)+edu+hinc+region,data=FV11,family="binomial"))
summary(mswing<-glm(swingvoter~female+age+I(age^2)+edu+hinc+region,data=FV11,family="binomial"))
agepreds<-as.data.frame(expand.grid(age=18:80,female=0,edu=levels(factor(FV11$edu)),hinc="400k-499k"))
agepreds$swingpredict<-predict(mswing,newdata=agepreds,type="response")
require(ggplot2)
ggplot(agepreds,aes(x=age,y=swingpredict,group=edu,color=edu)) +
geom_line() +
theme_minimal()
#read in agenda data
setwd("~/GitHub/votingmodels")
poldata<-read.csv("poldata.csv")
#recode variables to fit
poldata$female<-ifelse(poldata$gender=="Kvinde",1,0)
View(poldata)
names(poldata)
names(poldata)[14]
names(poldata)[14]<-"edu"
names(poldata)[16]<-"hinc"
levels(poldata$edu)
levels(FV11$edu)
FV11.a<-read.csv(file="/Users/frederikhjorth/Dropbox/Data/ElectionStudy-2011/ElectionStudy-2011_F1.csv",sep=",")
#get vars
FV11<-data.frame(elec=rep("FV11",nrow(FV11.a)))
FV11$female<-ifelse(FV11.a$v5==5,1,0)
FV11$age<-2011-FV11.a$v6
FV11$region<-as.factor(as.character(FV11.a$region))
FV11$edu<-NA
FV11$edu[FV11.a$v328==4]<-"Grundskole"
FV11$edu[FV11.a$v327 %in% 5:6]<-"Gymnasie"
FV11$edu[FV11.a$v329 %in% 5:6]<-"EUD"
FV11$edu[FV11.a$v329==7]<-"KVU"
FV11$edu[FV11.a$v329==8]<-"MVU"
FV11$edu[FV11.a$v329==10]<-"LVU"
FV11$edu<-as.factor(FV11$edu)
FV11$hinc<-NA
FV11$hinc[FV11.a$v314==1]<-"<100k"
FV11$hinc[FV11.a$v314 %in% 2:3]<-"100k-199k"
FV11$hinc[FV11.a$v314 %in% 4:5]<-"200k-299k"
FV11$hinc[FV11.a$v314 %in% 6:7]<-"300k-399k"
FV11$hinc[FV11.a$v314 %in% 8:9]<-"400k-499k"
FV11$hinc[FV11.a$v314==10]<-"500k-599k"
FV11$hinc[FV11.a$v314==11]<-"600k-699k"
FV11$hinc[FV11.a$v314==12]<-"700k-799k"
FV11$hinc[FV11.a$v314==13]<-"800k-899k"
FV11$hinc[FV11.a$v314==14]<-"900k-999k"
FV11$hinc[FV11.a$v314 %in% 15:20]<-">1M"
FV11$hinc[FV11.a$v314 %in% 88:99]<-"Vil ikke svare"
FV11$hinc<-as.factor(FV11$hinc)
FV11$leftvot.p<-ifelse(FV11.a$v67 %in% c(1,2,4,6,9),1,0)
FV11$leftvot.c<-ifelse(FV11.a$v54 %in% c(1,2,4,6,9),1,0)
FV11$redvot.p<-ifelse(FV11.a$v67 %in% c(1,4,9),1,0)
FV11$redvot.c<-ifelse(FV11.a$v54 %in% c(1,4,9),1,0)
FV11$safeblue<-ifelse(FV11$leftvot.p==0 & FV11$leftvot.c==0,1,0)
FV11$safered<-ifelse(FV11$leftvot.p==1 & FV11$leftvot.c==1,1,0)
FV11$swingvoter<-(FV11$leftvot.p - FV11$leftvot.c)^2
rm(FV11.a)
str(FV11)
#run voter models
summary(mblue<-glm(safeblue~female+age+I(age^2)+edu+hinc,data=FV11,family="binomial"))
summary(mred<-glm(safered~female+age+I(age^2)+edu+hinc,data=FV11,family="binomial"))
summary(mswing<-glm(swingvoter~female+age+I(age^2)+edu+hinc,data=FV11,family="binomial"))
agepreds<-as.data.frame(expand.grid(age=18:80,female=0,edu=levels(factor(FV11$edu)),hinc="400k-499k"))
agepreds$swingpredict<-predict(mswing,newdata=agepreds,type="response")
require(ggplot2)
ggplot(agepreds,aes(x=age,y=swingpredict,group=edu,color=edu)) +
geom_line() +
theme_minimal()
#read in agenda data
setwd("~/GitHub/votingmodels")
poldata<-read.csv("poldata.csv")
#recode variables to fit
poldata$female<-ifelse(poldata$gender=="Kvinde",1,0)
names(poldata)[14]<-"edu"
names(poldata)[16]<-"hinc"
levels(poldata$edu)
levels(FV11$edu)
FV11.a<-read.csv(file="/Users/frederikhjorth/Dropbox/Data/ElectionStudy-2011/ElectionStudy-2011_F1.csv",sep=",")
#get vars
FV11<-data.frame(elec=rep("FV11",nrow(FV11.a)))
FV11$female<-ifelse(FV11.a$v5==5,1,0)
FV11$age<-2011-FV11.a$v6
FV11$region<-as.factor(as.character(FV11.a$region))
FV11$edu<-"Anden/Vil ikke svare"
FV11$edu[FV11.a$v328==4]<-"Grundskole"
FV11$edu[FV11.a$v327 %in% 5:6]<-"Gymnasie"
FV11$edu[FV11.a$v329 %in% 5:6]<-"EUD"
FV11$edu[FV11.a$v329==7]<-"KVU"
FV11$edu[FV11.a$v329==8]<-"MVU"
FV11$edu[FV11.a$v329==10]<-"LVU"
FV11$edu<-as.factor(FV11$edu)
FV11$hinc<-NA
FV11$hinc[FV11.a$v314==1]<-"<100k"
FV11$hinc[FV11.a$v314 %in% 2:3]<-"100k-199k"
FV11$hinc[FV11.a$v314 %in% 4:5]<-"200k-299k"
FV11$hinc[FV11.a$v314 %in% 6:7]<-"300k-399k"
FV11$hinc[FV11.a$v314 %in% 8:9]<-"400k-499k"
FV11$hinc[FV11.a$v314==10]<-"500k-599k"
FV11$hinc[FV11.a$v314==11]<-"600k-699k"
FV11$hinc[FV11.a$v314==12]<-"700k-799k"
FV11$hinc[FV11.a$v314==13]<-"800k-899k"
FV11$hinc[FV11.a$v314==14]<-"900k-999k"
FV11$hinc[FV11.a$v314 %in% 15:20]<-">1M"
FV11$hinc[FV11.a$v314 %in% 88:99]<-"Vil ikke svare"
FV11$hinc<-as.factor(FV11$hinc)
FV11$leftvot.p<-ifelse(FV11.a$v67 %in% c(1,2,4,6,9),1,0)
FV11$leftvot.c<-ifelse(FV11.a$v54 %in% c(1,2,4,6,9),1,0)
FV11$redvot.p<-ifelse(FV11.a$v67 %in% c(1,4,9),1,0)
FV11$redvot.c<-ifelse(FV11.a$v54 %in% c(1,4,9),1,0)
FV11$safeblue<-ifelse(FV11$leftvot.p==0 & FV11$leftvot.c==0,1,0)
FV11$safered<-ifelse(FV11$leftvot.p==1 & FV11$leftvot.c==1,1,0)
FV11$swingvoter<-(FV11$leftvot.p - FV11$leftvot.c)^2
rm(FV11.a)
str(FV11)
#run voter models
summary(mblue<-glm(safeblue~female+age+I(age^2)+edu+hinc,data=FV11,family="binomial"))
summary(mred<-glm(safered~female+age+I(age^2)+edu+hinc,data=FV11,family="binomial"))
summary(mswing<-glm(swingvoter~female+age+I(age^2)+edu+hinc,data=FV11,family="binomial"))
agepreds<-as.data.frame(expand.grid(age=18:80,female=0,edu=levels(factor(FV11$edu)),hinc="400k-499k"))
agepreds$swingpredict<-predict(mswing,newdata=agepreds,type="response")
require(ggplot2)
ggplot(agepreds,aes(x=age,y=swingpredict,group=edu,color=edu)) +
geom_line() +
theme_minimal()
#read in agenda data
setwd("~/GitHub/votingmodels")
poldata<-read.csv("poldata.csv")
#recode variables to fit
poldata$female<-ifelse(poldata$gender=="Kvinde",1,0)
names(poldata)[14]<-"edu"
names(poldata)[16]<-"hinc"
levels(poldata$edu)
levels(FV11$edu)
levels(poldata$edu)<-c("Anden/Vil ikke svare","EUD","Grundskole","Gymnasie","KVU","LVU","MVU","Anden/Vil ikke svare")
levels(poldata$hinc)
levels(FV11$hinc)
levels(poldata$hinc)<-c(levels(FV11$hinc)[2],levels(FV11$hinc)[3:11],levels(FV11$hinc)[1],levels(FV11$hinc)[12],levels(FV11$hinc)[12])
predict(mswing,newdata=poldata,type="response")
poldata$swingprediction<-predict(mswing,newdata=poldata,type="response")
View(poldata)
View(poldata)
predictions<-data.frame(RESPID=poldata$RESPID,redprediction=predict(mred,newdata=poldata,type="response"),blueprediction=predict(mblue,newdata=poldata,type="response"),swingprediction=predict(mswing,newdata=poldata,type="response"))
write.csv(predictions,file="predictions.csv")
ggplot(predictions,aes(x=swingprediction)) +
geom_histogram()
require(ggplot2)
ggplot(agepreds,aes(x=age,y=swingpredict,group=edu,color=edu)) +
geom_line() +
theme_minimal()
